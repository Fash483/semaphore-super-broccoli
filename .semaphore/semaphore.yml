version: v1.0

name: Download Torrent and Upload to PixelDrain

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004

blocks:
  - name: Download & Upload
    task:
      env_vars:
        - name: PIXELDRAIN_API_KEY
          value: 5f45f184-64bb-4eaa-be19-4a5f0459db49   # üîê Replace with your actual key
        - name: TORRENT_MAGNET
          value: "magnet:?xt=urn:btih:..."              # üîó Replace with your magnet link
      jobs:
        - name: Download and Upload Files
          commands:
            - checkout
            - echo "üì¶ Installing webtorrent-cli..."
            - sudo apt update
            - sudo apt install -y nodejs npm
            - npm install -g webtorrent-cli

            - echo "üì• Downloading torrent..."
            - mkdir -p downloads
            - npx webtorrent "$TORRENT_MAGNET" --out downloads

            - echo "üì§ Uploading files to PixelDrain..."
            - |
              find downloads -type f -print0 | while IFS= read -r -d '' file; do
                curl -X POST "https://upload.gofile.io/uploadfile" \
                     -H "Authorization: Bearer NkEP9nPmjC5bYQB7ZabZKnsUEBi7ww85" \
                     -F "file=@\"$file\"" \
                     -F "folderId=569169f0-479c-4720-857a-2aa341d5eca9"
              done
